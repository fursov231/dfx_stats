{"ast":null,"code":"import axios from 'axios';\n/*\r\n    /api/compound/info\r\n    Returns general data about COMP token\r\n    and market volumes\r\n*/\n\nconst instance = axios.create({\n  withCredentials: true,\n  headers: {\n    \"X-CMC_PRO_API_KEY\": \"e53a20b7-ddd6-4ad0-8dbc-13787839f1a66\"\n  }\n});\nexport default ((req, res) => {\n  return new Promise(resolve => {\n    // Pull COMP price\n    instance.get(\"https://pro-api.coinmarketcap.com/v2/cryptocurrency/quotes/latest?id=7797\").then(cg => {\n      // PUll COMP dispensed info\n      axios.get(\"https://api.compound.finance/api/v2/governance/comp?network=mainnet\").then(comp => {\n        // Pull COMP exchange volumes\n        axios.get(\"https://api.coingecko.com/api/v3/coins/compound-governance-token/tickers?include_exchange_logo=true\").then(cgtickers => {\n          let tickers = cgtickers.data.tickers; // Collect exchanges\n\n          let sorted = tickers.sort(function (a, b) {\n            return b.converted_volume.usd - a.converted_volume.usd;\n          }); // Sort exchanges by volume\n\n          let cleaned = []; // Setup cleaned array\n\n          let total_volume = 0; // Setup total volume value\n          // Loop through exchanges\n\n          for (let i = 0; i < sorted.length; i++) {\n            // Select only exchanges with green trust score\n            if (sorted[i].trust_score === 'green') {\n              cleaned.push(sorted[i]); // Push exchange info to cleaned array\n\n              total_volume += sorted[i].converted_volume.usd; // Increment total volume\n            }\n          } // Return response JSON object\n\n\n          let response = {\n            \"current_price\": cg.data.data[7797].quote.USD.price.toFixed(2),\n            // \"total_supply\": cg.data[0].total_supply,\n            \"total_comp_distributed\": parseInt(comp.data.total_comp_allocated),\n            \"total_volume\": cg.data.data[7797].quote.USD.volume_24h,\n            \"market_cap\": cg.data.data[7797].quote.USD.market_cap,\n            \"tickers\": cleaned\n          };\n          res.send(response);\n          res.status(200).end();\n          console.log(response.current_price);\n          resolve();\n        });\n      });\n    });\n  });\n});","map":{"version":3,"sources":["C:/Users/furso/Desktop/stat.farm/pages/api/compound/info.js"],"names":["axios","instance","create","withCredentials","headers","req","res","Promise","resolve","get","then","cg","comp","cgtickers","tickers","data","sorted","sort","a","b","converted_volume","usd","cleaned","total_volume","i","length","trust_score","push","response","quote","USD","price","toFixed","parseInt","total_comp_allocated","volume_24h","market_cap","send","status","end","console","log","current_price"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEA;AACA;AACA;AACA;AACA;;AACA,MAAMC,QAAQ,GAAGD,KAAK,CAACE,MAAN,CAAa;AAC1BC,EAAAA,eAAe,EAAE,IADS;AAE1BC,EAAAA,OAAO,EAAE;AACL,yBAAqB;AADhB;AAFiB,CAAb,CAAjB;AAOA,gBAAe,CAACC,GAAD,EAAMC,GAAN,KAAc;AACzB,SAAO,IAAIC,OAAJ,CAAYC,OAAO,IAAI;AAC1B;AACAP,IAAAA,QAAQ,CAACQ,GAAT,CAAa,2EAAb,EAA0FC,IAA1F,CAA+FC,EAAE,IAAI;AACjG;AACAX,MAAAA,KAAK,CAACS,GAAN,CAAU,qEAAV,EAAiFC,IAAjF,CAAsFE,IAAI,IAAI;AAC1F;AACAZ,QAAAA,KAAK,CAACS,GAAN,CAAU,qGAAV,EAAiHC,IAAjH,CAAsHG,SAAS,IAAI;AAC/H,cAAIC,OAAO,GAAGD,SAAS,CAACE,IAAV,CAAeD,OAA7B,CAD+H,CACzF;;AACtC,cAAIE,MAAM,GAAGF,OAAO,CAACG,IAAR,CAAa,UAASC,CAAT,EAAYC,CAAZ,EAAe;AAAC,mBAAOA,CAAC,CAACC,gBAAF,CAAmBC,GAAnB,GAAyBH,CAAC,CAACE,gBAAF,CAAmBC,GAAnD;AAAuD,WAApF,CAAb,CAF+H,CAE3B;;AACpG,cAAIC,OAAO,GAAG,EAAd,CAH+H,CAG7G;;AAClB,cAAIC,YAAY,GAAG,CAAnB,CAJ+H,CAIzG;AAEtB;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,MAAM,CAACS,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;AACpC;AACA,gBAAIR,MAAM,CAACQ,CAAD,CAAN,CAAUE,WAAV,KAA0B,OAA9B,EAAuC;AACnCJ,cAAAA,OAAO,CAACK,IAAR,CAAaX,MAAM,CAACQ,CAAD,CAAnB,EADmC,CACV;;AACzBD,cAAAA,YAAY,IAAIP,MAAM,CAACQ,CAAD,CAAN,CAAUJ,gBAAV,CAA2BC,GAA3C,CAFmC,CAEa;AACnD;AACJ,WAb8H,CAc/H;;;AACA,cAAIO,QAAQ,GAAG;AACX,6BAAiBjB,EAAE,CAACI,IAAH,CAAQA,IAAR,CAAa,IAAb,EAAmBc,KAAnB,CAAyBC,GAAzB,CAA6BC,KAA7B,CAAmCC,OAAnC,CAA2C,CAA3C,CADN;AAEZ;AACC,sCAA0BC,QAAQ,CAACrB,IAAI,CAACG,IAAL,CAAUmB,oBAAX,CAHvB;AAIX,4BAAgBvB,EAAE,CAACI,IAAH,CAAQA,IAAR,CAAa,IAAb,EAAmBc,KAAnB,CAAyBC,GAAzB,CAA6BK,UAJlC;AAKX,0BAAcxB,EAAE,CAACI,IAAH,CAAQA,IAAR,CAAa,IAAb,EAAmBc,KAAnB,CAAyBC,GAAzB,CAA6BM,UALhC;AAMX,uBAAWd;AANA,WAAf;AASAhB,UAAAA,GAAG,CAAC+B,IAAJ,CAAST,QAAT;AACAtB,UAAAA,GAAG,CAACgC,MAAJ,CAAW,GAAX,EAAgBC,GAAhB;AACAC,UAAAA,OAAO,CAACC,GAAR,CAAYb,QAAQ,CAACc,aAArB;AACAlC,UAAAA,OAAO;AACV,SA5BD;AA6BH,OA/BD;AAgCH,KAlCD;AAmCH,GArCM,CAAP;AAsCH,CAvCD","sourcesContent":["import axios from 'axios'\r\n\r\n/*\r\n    /api/compound/info\r\n    Returns general data about COMP token\r\n    and market volumes\r\n*/\r\nconst instance = axios.create({\r\n    withCredentials: true,\r\n    headers: {\r\n        \"X-CMC_PRO_API_KEY\": \"e53a20b7-ddd6-4ad0-8dbc-13787839f1a66\"},\r\n});\r\n\r\n\r\nexport default (req, res) => {\r\n    return new Promise(resolve => {\r\n        // Pull COMP price\r\n        instance.get(\"https://pro-api.coinmarketcap.com/v2/cryptocurrency/quotes/latest?id=7797\").then(cg => {\r\n            // PUll COMP dispensed info\r\n            axios.get(\"https://api.compound.finance/api/v2/governance/comp?network=mainnet\").then(comp => {\r\n                // Pull COMP exchange volumes\r\n                axios.get(\"https://api.coingecko.com/api/v3/coins/compound-governance-token/tickers?include_exchange_logo=true\").then(cgtickers => {\r\n                    let tickers = cgtickers.data.tickers; // Collect exchanges\r\n                    let sorted = tickers.sort(function(a, b) {return b.converted_volume.usd - a.converted_volume.usd}); // Sort exchanges by volume\r\n                    let cleaned = []; // Setup cleaned array\r\n                    let total_volume = 0; // Setup total volume value\r\n\r\n                    // Loop through exchanges\r\n                    for (let i = 0; i < sorted.length; i++) {\r\n                        // Select only exchanges with green trust score\r\n                        if (sorted[i].trust_score === 'green') {\r\n                            cleaned.push(sorted[i]); // Push exchange info to cleaned array\r\n                            total_volume += sorted[i].converted_volume.usd; // Increment total volume\r\n                        }\r\n                    }\r\n                    // Return response JSON object\r\n                    let response = {\r\n                        \"current_price\": cg.data.data[7797].quote.USD.price.toFixed(2),\r\n                       // \"total_supply\": cg.data[0].total_supply,\r\n                        \"total_comp_distributed\": parseInt(comp.data.total_comp_allocated),\r\n                        \"total_volume\": cg.data.data[7797].quote.USD.volume_24h,\r\n                        \"market_cap\": cg.data.data[7797].quote.USD.market_cap,\r\n                        \"tickers\": cleaned,\r\n                    }\r\n\r\n                    res.send(response);\r\n                    res.status(200).end();\r\n                    console.log(response.current_price)\r\n                    resolve();\r\n                })\r\n            })\r\n        })\r\n    })\r\n}\r\n"]},"metadata":{},"sourceType":"module"}